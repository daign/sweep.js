var SWEEP={SVGNS:"http://www.w3.org/2000/svg",animationSpeed:1,sweepActive:!1,compare:function(a,b){return a.compare(b)},init:function(){function a(){requestAnimationFrame(a);TWEEN.update()}this.points=new js_cols.RedBlackSet(this.compare);this.events=new js_cols.RedBlackSet(this.compare);this.status=new js_cols.RedBlackSet(this.compare);this.intersections=new js_cols.RedBlackSet(this.compare);SWEEP.SVG.init();SWEEP.Gui.init();SWEEP.Sweepline.init();SWEEP.Input();a()},sweep:function(){this.sweepActive||
(this.sweepActive=!0,this.cleanup(),SWEEP.Sweepline.sweepNext(this.events.getMin()))},cleanup:function(){SWEEP.Sweepline.position=0;SWEEP.Sweepline.setPosition();this.status.clear();this.events.clear();this.events.insertAll(SWEEP.points);this.intersections.traverse(function(a){a.remove()},this);this.intersections.clear()},onEnd:function(){console.log("\nIntersections:");this.intersections.traverse(function(a){console.log("\t"+a.toString())},this);this.sweepActive=!1;this.status.isEmpty()||console.warn("status not empty")}};SWEEP.SVG={init:function(){this.context=document.createElementNS(SWEEP.SVGNS,"svg");this.context.setAttribute("viewBox","-1, -1, 102, 102");this.context.setAttribute("width","400px");this.context.setAttribute("height","400px");document.body.appendChild(this.context);bg=document.createElementNS(SWEEP.SVGNS,"rect");bg.setAttribute("x",-1);bg.setAttribute("y",-1);bg.setAttribute("width",102);bg.setAttribute("height",102);bg.setAttribute("class","bg");this.context.appendChild(bg)},appendChild:function(a){this.context.appendChild(a)},
removeChild:function(a){this.context.removeChild(a)}};SWEEP.Gui={init:function(){this.start=document.createElement("div");this.start.innerHTML="Sweep";this.start.setAttribute("class","button");document.body.appendChild(this.start);this.start.addEventListener("click",function(){SWEEP.sweep()},!1)}};SWEEP.Sweepline={position:0,pairs:[],init:function(){this.line=document.createElementNS(SWEEP.SVGNS,"line");this.line.setAttribute("x1",0);this.line.setAttribute("x2",100);this.line.setAttribute("class","sweepline");SWEEP.SVG.appendChild(this.line);this.setPosition()},setPosition:function(){this.line.setAttribute("y1",this.position);this.line.setAttribute("y2",this.position)},eventCall:function(){var a=this.current;if(a.intersection){console.log("Event:"+a.toString()+"; Switching; Status:");var b=
SWEEP.status.clone();SWEEP.status.clear();SWEEP.status.insertAll(b);var b=SWEEP.status.predecessor(a.lines.getMax()),c=SWEEP.status.successor(a.lines.getMin());null!==b&&this.pairs.push([b,a.lines.getMax()]);null!==c&&this.pairs.push([a.lines.getMin(),c])}else{var d=a.lines.getMin();d.startPoint===a?(console.log("Event:"+a.toString()+"; Adding; Status:"),SWEEP.status.insert(d),b=SWEEP.status.predecessor(d),c=SWEEP.status.successor(d),null!==b&&this.pairs.push([b,d]),null!==c&&this.pairs.push([d,c])):
(console.log("Event:"+a.toString()+"; Removing; Status:"),b=SWEEP.status.predecessor(d),c=SWEEP.status.successor(d),SWEEP.status.remove(d),null!==b&&null!==c&&this.pairs.push([b,c]))}SWEEP.status.traverse(function(a){console.log("\t"+a.toString())},this);this.doPairs()},doPairs:function(){0<this.pairs.length?this.intersectionCheck(this.pairs.pop()):this.sweepNext(SWEEP.events.successor(this.current))},intersectionCheck:function(a){var b=a[0],c=a[1];this.action=0;b.line.style.stroke="red";c.line.style.stroke=
"red";a=b.intersect(c);null!==a&&(a=new SWEEP.Point(a[0],a[1],!0),SWEEP.events.contains(a)||(a.addLine(b),a.addLine(c),a.draw(),SWEEP.events.insert(a),SWEEP.intersections.insert(a)));(new TWEEN.Tween(this)).to({action:100},400*SWEEP.animationSpeed).onUpdate(function(){var a=(50-Math.abs(this.action-50))*0.02+0.5;b.line.style.strokeWidth=a+"px";c.line.style.strokeWidth=a+"px"}).onComplete(function(){b.line.style.stroke="#ccc";c.line.style.stroke="#ccc";this.doPairs()}).start()},sweepNext:function(a){null!==
a?(this.current=a,this.sweepTo(a.y,function(){a.animate()})):this.sweepTo(100,function(){SWEEP.onEnd()})},sweepTo:function(a,b){(new TWEEN.Tween(this)).to({position:a},25*(a-this.position)*SWEEP.animationSpeed).onUpdate(function(){this.setPosition()}).onComplete(b).start()}};SWEEP.Input=function(){var a=function(a,b,g){a=new SWEEP.Point(a,b,!1);a.addLine(g);a.draw();SWEEP.points.insert(a);return a},b=function(b,d,g,f){var e=new SWEEP.Line,b=a(b,d,e),g=a(g,f,e);e.setPoints(b,g)};b(29,42,70,10);b(70,70,40,22);b(85,60,20,80);b(10,32,60,90);b(25,95,65,4);b(12,14,22,26);b(79,7,93,55);b(67,53,97,44)};SWEEP.Point=function(a,b,c){this.x=a;this.y=b;this.lines=new js_cols.RedBlackSet(SWEEP.compare);this.intersection=c};
SWEEP.Point.prototype={constructor:SWEEP.Point,draw:function(){this.point=document.createElementNS(SWEEP.SVGNS,"circle");this.point.setAttribute("cx",this.x);this.point.setAttribute("cy",this.y);this.point.setAttribute("r",1);this.point.setAttribute("class","point");this.point.style.fill=this.intersection?"#157":"#999";SWEEP.SVG.appendChild(this.point)},remove:function(){SWEEP.SVG.removeChild(this.point)},addLine:function(a){this.lines.insert(a)},animate:function(){this.action=-100;this.point.style.fill=
"red";(new TWEEN.Tween(this)).to({action:100},400*SWEEP.animationSpeed).onUpdate(function(){this.setSize(0.02*(100-Math.abs(this.action))+1)}).onComplete(function(){this.point.style.fill=this.intersection?"#157":"#999";SWEEP.Sweepline.eventCall()}).start()},setSize:function(a){this.point.setAttribute("r",a)},toString:function(){return"{x:"+Math.round(100*this.x)/100+",y:"+Math.round(100*this.y)/100+"}"},compare:function(a){return this.y<a.y?-1:a.y<this.y?1:0}};SWEEP.Line=function(){this.endPoint=this.startPoint=void 0;this.line=document.createElementNS(SWEEP.SVGNS,"line");this.line.setAttribute("class","line");SWEEP.SVG.appendChild(this.line)};
SWEEP.Line.prototype={constructor:SWEEP.Line,setPoints:function(a,b){a.y<b.y?(this.startPoint=a,this.endPoint=b):(this.startPoint=b,this.endPoint=a);this.line.setAttribute("x1",this.startPoint.x);this.line.setAttribute("y1",this.startPoint.y);this.line.setAttribute("x2",this.endPoint.x);this.line.setAttribute("y2",this.endPoint.y)},compare:function(a){return this.getSweepIntersection()<a.getSweepIntersection()?-1:a.getSweepIntersection()<this.getSweepIntersection()?1:0},getSweepIntersection:function(){var a=
(this.endPoint.y-this.startPoint.y)/(this.endPoint.x-this.startPoint.x);return(SWEEP.Sweepline.position+0.001-(this.endPoint.y-a*this.endPoint.x))/a},intersect:function(a){var b=this.startPoint.x,c=this.startPoint.y,d=this.endPoint.x,g=this.endPoint.y,f=a.startPoint.x,e=a.startPoint.y,h=a.endPoint.x,a=a.endPoint.y,i=(d-b)*(a-e)-(g-c)*(h-f);return 0!==i&&(e=((f-b)*(a-e)-(e-c)*(h-f))/i,f=(b-f+e*(d-b))/(h-f),0<=e&&1>=e&&0<=f&&1>=f)?[b+e*(d-b),c+e*(g-c)]:null},toString:function(){return"{line:["+this.startPoint.toString()+
","+this.endPoint.toString()+"]}"}};
